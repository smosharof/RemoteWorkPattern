---
title: "Results"
author: [Moe Shamim, UNI: ms7285]
execute:
  cache: true
  echo: true
format:
  html:
    fig-width: 7
    fig-height: 5
    embed-resources: true
editor_options: 
  chunk_output_type: inline
---


```{r setup}
# Load required libraries
library(tidycensus)
library(tidyverse)
library(sf)
library(tigris)
library(ggplot2)
library(viridis)
library(httr)
library(jsonlite)
library(readr)
options(tigris_use_cache = TRUE)
options(tidycensus.quiet = TRUE)
```


We address three questions:

1. How did remote-work vary by region and industry after COVID-19?
2. How has commuting time, public transport usage, or road traffic changed?
3. Are there links between remote-work adoption and residential migration?

---

Remote Work  by Region and Industry

(Data Source: U.S. Census Bureau, ACS 1-Year Estimates)

```{r remote-work-data}
# Compare 2019 vs 2022 ACS data for "Worked from home"
acs_remote_2019 <- get_acs(
  geography = "state",
  variables = c(total = "B08006_001", remote = "B08006_017"),
  year = 2019,
  survey = "acs1"
) %>%
  select(NAME, variable, estimate) %>%
  pivot_wider(names_from = variable, values_from = estimate) %>%
  mutate(remote_pct_2019 = 100 * remote / total)

acs_remote_2022 <- get_acs(
  geography = "state",
  variables = c(total = "B08006_001", remote = "B08006_017"),
  year = 2022,
  survey = "acs1"
) %>%
  select(NAME, variable, estimate) %>%
  pivot_wider(names_from = variable, values_from = estimate) %>%
  mutate(remote_pct_2022 = 100 * remote / total)

acs_remote_change <- left_join(acs_remote_2019, acs_remote_2022, by = "NAME") %>%
  mutate(change = remote_pct_2022 - remote_pct_2019)

```


### Plot 1 - Change in % Working from Home 
```{r remote-work-bar, fig.width=8, fig.height=6}
ggplot(acs_remote_change, aes(x = reorder(NAME, change), y = change)) +
  geom_col(fill = "steelblue") +
  coord_flip() +
  labs(title = "Change in Remote Work Share by State (2019–2022)",
       x = "State", y = "Change in % Working from Home") +
  theme_minimal()
```
**Interpretation**

The plot shows how much each state’s share of remote workers increased from 2019 to 2022. While many Southern and Midwestern states saw smaller increases, Washington, Maryland, Virginia, and District of Columbia saw the largest jumps. One curious fact about District of Columbia, Maryland, and Virginia is that many federal employees live in those states due to close proximity to the federal offices such as Capitol Hill or Pentagon. This may be an indicator that the U.S. Government was one of the largest adopters of the remote work during that period.

### Plot 2 - Impact of Local stringency at the height of Covid (2020) 

Source: Oxford Covid-19 Government Response Tracker (OxCGRT) https://github.com/OxCGRT/covid-policy-tracker/tree/master

```{r stringency-bar, fig.width=8, fig.height=6}

library(dplyr)
library(readr)
library(ggplot2)
library(stringr)

# Load clean policy data
policy <- read_csv(
  "/Users/a348092/Documents/Mshamim_Docs/Continuing Education/EDAV/RemoteWorkPattern/policy_state_clean.csv",
  show_col_types = FALSE
)

# States to highlight
highlight_states <- c(
  "District Of Columbia",
  "Washington",
  "Maryland",
  "Massachusetts",
  "Virginia"
)

# Prepare data
policy_bar <- policy %>%
  mutate(
    state = str_to_title(region)   # Clean labels
  ) %>%

  arrange(stringency_2020)

# Base plot
ggplot(policy_bar, aes(x = reorder(state, stringency_2020),
                       y = stringency_2020,
                       fill = stringency_2020)) +
  geom_col() +
  coord_flip() +
  scale_fill_gradient(low = "lightblue", high = "navy") +
  
  # Highlighted labels for the selected states
  geom_text(
    data = policy_bar %>% filter(state %in% highlight_states),
    aes(label = state),
    color = "black",
    fontface = "bold",
    hjust = -0.1,
    size = 3
  ) +
  
  labs(
    title = "COVID-19 Stringency Index by State (2020)",
    subtitle = "Bold labels highlight top remote-work growth states",
    x = "State",
    y = "Stringency Index (Oxford)"
  ) +
  
  theme_minimal() +
  theme(
    axis.text.y = element_text(size = 8),
    plot.title  = element_text(size = 16, face = "bold")
  )
```
**Interpretation**

The plot shows how strict each state’s COVID-19 policies were in 2020, with darker bars representing stronger restrictions. States like Mississippi, Arkansas, and Texas had among the highest average stringency, while Maryland, Virginia, and the Carolinas were among the lowest. The highlighted states—Washington, Massachusetts, Virginia, Maryland, and D.C.—experienced major remote-work growth, yet they vary widely in policy strictness, suggesting that strong remote-work adoption wasn’t driven solely by how strict a state’s COVID-19 measures were.

### Plot 3 - Remote Work Share by State
```{r}
library(dplyr)
library(tidyr)
library(tibble)
library(choroplethr)

# Step 1: Prepare ACS data in the required format
df_remote <- acs_remote_2022 %>%
  transmute(
    region = tolower(NAME),         # match choroplethr naming
    value = remote_pct_2022         # renamed to "value"
  )

# Step 2: Draw the map using state_choropleth
state_choropleth(df_remote,
                 title  = "Remote Work Share by State (ACS 2022)",
                 legend = "% Working from Home")

```
**Interpretation:**

The map shows large geographic variation in remote-work adoption in 2022. States on the West Coast (WA, OR, CA), Mountain West (CO, UT), and the Northeast (MA, MD, VA, DC) have the highest work-from-home rates. Much of the South and Midwest remain lower. The pattern suggests remote work is most prevalent in regions with strong tech, professional services, and knowledge-economy labor markets.

### Plot 4 - Employment Drop and Recovery During COVID-19
```{r}
library(readr)
library(dplyr)
library(tibble)
library(ggplot2)

# Step 1: Load CES data
bls_raw <- read_tsv(
  "/Users/a348092/Documents/Mshamim_Docs/Continuing Education/EDAV/RemoteWorkPattern/ce.data.0.AllCESSeries.txt",
  col_names = c("series_id","year","period","value","footnote"),
  skip = 1
)

# Step 2: Updated industries (P&B Services removed, Other Services added)
industries <- tibble(
  series_id = c(
    "CES1000000001",  # Mining & Logging
    "CES2000000001",  # Construction
    "CES3000000001",  # Manufacturing
    "CES5000000001",  # Information Technology
    "CES5500000001",  # Financial Services
    "CES6500000001",  # Education & Health Services
    "CES7000000001",  # Leisure & Hospitality
    "CES9000000001",  # Government
    "CES8000000001"   # Other Services
  ),
  label = c(
    "Mining & Logging",
    "Construction",
    "Manufacturing",
    "Information Technology",
    "Financial Services",
    "Education & Health Services",
    "Leisure & Hospitality",
    "Government",
    "Other Services"
  )
)

# Step 3: Filter dataset to selected industries
df_bls <- bls_raw %>%
  filter(series_id %in% industries$series_id,
         period != "M13") %>%
  mutate(
    month = as.integer(substr(period, 2, 3)),
    date = as.Date(paste(year, month, "1"), "%Y %m %d"),
    value = as.numeric(value)
  ) %>%
  left_join(industries, by = "series_id")

# Step 4: Zoom into 2018–2024 (COVID focus)
df_zoom <- df_bls %>%
  filter(date >= as.Date("2018-01-01"))

# Step 5: COVID shock plot with fixed y-axis
ggplot(df_zoom, aes(date, value)) +
  geom_line(color = "steelblue", size = 0.9) +
  geom_vline(xintercept = as.Date("2020-03-01"),
             linetype = "dashed", color = "red", linewidth = 0.6) +
  facet_wrap(~ label, scales = "fixed", ncol = 3) +
  labs(
    title = "Employment Drop and Recovery During COVID-19",
    x = "Year",
    y = "Employment (Thousands)"
  ) +
  scale_x_date(date_breaks = "1 year", date_labels = "%Y") +
  theme_minimal(base_size = 12) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1, size = 9),
    strip.text = element_text(size = 11, face = "bold")
  )
```
**Interpretation:**

The plot shows how COVID-19 affected employment across major U.S. industries. Leisure & Hospitality experienced the steepest collapse, while Construction, Government, Financial Services, and IT saw milder declines. Most sectors recovered gradually after 2020, but the size and speed of recovery varied, revealing uneven pandemic impacts across the labor market.

### Plot 5 - Seasonal Heatmap of Monthly Vehicle Miles Traveled

```{r fhwa-traffic}
library(tidyverse)
library(lubridate)

# Load FRED key once (if not already done)
library(fredr)
fredr_set_key(Sys.getenv("FRED_API_KEY"))

# Get FHWA Vehicle Miles Traveled data from FRED
vmt <- fredr(
  series_id = "TRFVOLUSM227NFWA",  # FHWA total vehicle miles
  observation_start = as.Date("2018-01-01")
)

# Step 1: Prepare VMT data
vmt_heat <- vmt %>%
  mutate(
    Year = year(date),
    Month = month(date, label = TRUE, abbr = TRUE)
  )

# Step 2: Plot heatmap
ggplot(vmt_heat, aes(x = Month, y = factor(Year), fill = value)) +
  geom_tile(color = "white") +
  scale_fill_viridis_c(
    option = "plasma",
    name = "Vehicle Miles\n(Billions)",
    direction = -1
  ) +
  labs(
    title = "Seasonal Heatmap of Monthly Vehicle Miles Traveled",
    subtitle = "FHWA Vehicle Miles Traveled (VMT) via FRED",
    x = "Month",
    y = "Year"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    axis.text.x = element_text(size = 10),
    axis.text.y = element_text(size = 10),
    plot.title = element_text(size = 16, face = "bold"),
    plot.subtitle = element_text(size = 12)
  )

```
**Interpretation:**

The heatmap shows strong seasonal patterns in U.S. vehicle travel, with higher volumes in summer and lower in winter. A dramatic collapse appears in April 2020 during COVID lockdowns, followed by gradual recovery. Recent years show a return to typical seasonal rhythms, though not always matching pre-pandemic peaks.


### Plot 6 - Remote Work vs. Interstate Migration (2022, by State)

```{r}
library(tidyverse)
library(tidycensus)

# Silence ACS messages
options(tidycensus.quiet = TRUE)

# -------------------------------
# 1. Remote work by state (ACS 2022)
# -------------------------------
acs_remote_2022 <- get_acs(
  geography = "state",
  variables = c(
    total = "B08006_001",   # Total workers
    remote = "B08006_017"   # Worked from home
  ),
  year = 2022,
  survey = "acs1"
) %>%
  select(NAME, variable, estimate) %>%
  pivot_wider(names_from = variable, values_from = estimate) %>%
  mutate(remote_pct_2022 = 100 * remote / total)

# -------------------------------
# 2. Interstate migration by state (ACS 2022)
# -------------------------------
acs_interstate_2022 <- get_acs(
  geography = "state",
  variables = c(
    total      = "B07001_001",
    diff_state = "B07001_010"
  ),
  year = 2022,
  survey = "acs1"
) %>%
  select(NAME, variable, estimate) %>%
  pivot_wider(names_from = variable, values_from = estimate) %>%
  mutate(interstate_pct = 100 * diff_state / total)

# -------------------------------
# 3. Merge datasets
# -------------------------------
migration_remote_interstate <- left_join(
  acs_remote_2022,
  acs_interstate_2022,
  by = "NAME"
)

# -------------------------------
# 4. Scatter plot (NO regression line)
# -------------------------------
ggplot(migration_remote_interstate,
       aes(x = remote_pct_2022, y = interstate_pct)) +
  geom_point(color = "steelblue", size = 3) +
  labs(
    title = "Remote Work vs. Interstate Migration (2022, by State)",
    x = "% Working from Home",
    y = "% Moved from Different State (Past Year)"
  ) +
  theme_minimal()

```



**Interpretation**:

The scatterplot shows that states with higher remote-work rates do not necessarily experience higher levels of interstate migration. Most states cluster between 5–6% interstate movers regardless of remote-work prevalence, suggesting only a weak relationship. Outliers exist—such as a high remote-work state with typical migration levels—but overall, remote work does not appear to strongly drive cross-state relocation in 2022.





